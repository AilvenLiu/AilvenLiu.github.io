---
layout:     post
title: 计算机网络常见问题合集
subtitle:   计算机网络               
date:       2022-05-21
author:     OUC_LiuX
header-img: img/wallpic02.jpg
catalog: true
tags: 
    - CS basis
---      

## 计算机网络三种模型       
OSI七层网络模型 是国际标准化组织 ISO 给出的标准参考模型。OSI标准模型将计算机网络从下到上划分为七层：物理层、数据链路层、网络层、传输层、会话层、表示层和应用层。        
TCP/IP四层模型是实际生产中使用的模型，是事实上的国际标准。TCP/IP 四层模型将计算机网络从下到上划分为 网络接口层、网络层、传输层和应用层。        
TCP/IP 五层模型是一种更适合学习的网络模型，它将网络接口层进一步划分为 物理层和数据链路层。其中：      
1. **应用层** 面向用户程序，解决用户进程之间的交互问题。应用层协议定义了应用进程间的通信和交互规则，如 DNS、HTTP、SMTP 等常用协议都属于应用层协议。                

2. **传输层** 面相数据传输，解决两台主机之间数据传输的问题。应用层报文通过传输层传输。两个最知名的传输层协议是 UDP 和 TCP 。            

3. **网络层** 主要解决数据在网络中传播的问题。具体的，两台计算机之间可能会经过多个数据链路、会经过很多通信子网。网络层的任务就是选择合适的路由和交换节点，确保数据及时传送。            
    
4. **数据链路层** 。两台主机之间的通信链路通常由一段又一段的子链路连接组成，数据链路层负责将网络层交付下来的分组封装成帧，在两个相邻节点之间传送数据帧。每一帧包含数据和必要的控制信息（同步信息、地址信息、差错控制等等） 。   

5. **物理层** 物理层传输的单位是比特。物理层存在的意义是实现**相邻网络节点间比特流的透明传送**，尽可能屏蔽掉具体传输介质和物理设备的差异，使数据链路层不必考虑网络的具体传输介质是什么。透明比特流传输指的是经电路传送后的比特流不发生变化。     

#### 五层模型各自包含哪些协议       
1. **应用层**： 超文本传输协议 HTTP，文件传输协议 FTP，简单邮件传输协议 SMTP，域名协议 DNS，安全外壳协议 SSH，动态主机配置协议 DHCP，远程登录协议 TELNET ，实时流协议 RSTP 。         
2. **传输层**： 传输控制协议 TCP， 用户数据报协议 UDP。    
3. **网络层**： 网际协议 IP，地址转换协议 ARP， 反向地址转换协议 RARP， Internet 控制报文协议 ICMP， Internet 组管理协议 IGMP， 路由信息协议 RIP。        
4. **数据链路层**： 自动重传请求协议 ARQ， 带冲突检测的载波侦听多路访问协议 CSMA/CD，点对点协议 PPP。      
5. **物理层**： 主要是规范物理介质及接口，比如 用语规范无线网络连接的 IEEE802.11 协议族 ，有线网使用的 RJ45 接口协议。      


## ARP 协议          

网络层的 ARP 协议负责完成 **IP 地址与物理地址的映射**。每台主机都会在自己的 ARP 缓存区中建立一个 ARP 列表，用以存储IP 地址和 MAC 地址的对应关系。当源主机需要将一个数据包发送到目的主机，会首先检查自己的 ARP 列表中是否存在目的主机 IP 对应的 MAC 地址，如果存在就直接发送到这个 MAC；如果没有就向本网段发起一个 ARP 请求的广播包，查询此目的主机对应的 MAC 地址。         
ARP 请求数据包里包括源主机 IP 和 MAC 以及目的主机 IP。网络中所有主机手到这个 ARP 请求数据包后，会检查数据包中的目的主机 IP 是否和自己的 IP 一致。 如果不一致，则忽略该请求包。如果一致，目的主机首先将发送端的 IP-MAC 关系存入自己的 APR 缓存表，如果表中已有发送端 IP 信息，则覆盖，然后向发送端返回一个 ARP 响应数据包，包含该主机 IP-MAC 信息；源主机收到这个数据包后就将目的主机的 IP-MAC 关系记录到自己的 APR 表中，并开始数据传输。如果源主机一直没有收到响应包，表示 ARP 查询失败。    

## TCP 和 UDP       

1. TCP 是面向连接的，一定要建立端到端之间的连接（三次握手）才能开始通信；UDP 是无连接的，发送端只需要知悉接收端信息，只管发送。        
2. 每一条 TCP 连接只能有两个端点，每一条 TCP 连接只能是点对点的；UDP 支持一对一、一对多、多对一、多对多交互通信。      
3. TCP 是可靠的，UDP 尽最大努力交付，不保证可靠性。       
4. TCP 是面向字节流的，数据没有长度便捷的限制，接收可以逐字节；UDP是面向报文的，每个数据报都有一个长度，接收端必须要改长度为最小单位读出数据。       
   面向字节流的理解是：尽管应用程序和 TCP 的交互是一次一个数据块，但 TCP 把应用程序交付下来的数据仅仅看成是一串无结构的字节流，发送端的报文大小和接收端不必要对应。比如发送端可以分十次发送共1000 字节的数据，而接收端可以一次性读完。面向报文的理解是，UDP 发送的数据和对端的接收一定要是对应的。这是由 TCP 和 UDP 的特性决定的。TCP 是面向连接的是可靠的，通信连接建立起来，只要发送端有序，接收端随便读取。而 UDP 是不可靠的是无连接的，接收端和发送端必须按照约定的格式（报文）才能成功读取内容。      
5. TCP 首部除了源和目的端信息，还包含有控制、序号等部分，至少20字节，UDP 首部只有8字节，更轻便。     

## TCP 为什么可靠       
TCP 是可靠传输协议，保证对端接收到的字节流和发送方发出的字节流是完全一样的。这种可靠性首先来源于三次握手，三次握手确认服务端和客户端 互相能接受到对方数据 才建立连接进行通信。建立连接之后保证可靠性的机制主要有如下几种：     
1. 校验和机制        
2. 序列号和确认应答机制       
3. 重传机制      
4. 流量控制       
5. 拥塞控制      

#### 校验和 CheckSum 机制       

校验和机制指的是发送端在数据发送之前计算报文段的校验和并添加到TCP 首部的 Checksum 字段，接收端接收到数据后按照同样的方法计算校验和并和接收到的 TCP 报文首部的 Checksum 字段进行比较，如果不一致则丢弃该报文段等待发送端重传。       
TCP 在计算校验和的时候需要添加一个十二字节的伪首部，包含源端IP 目的端 IP，保留字节，传输层协议和报文长度，首部在 IP 分组头获取，只用于计算校验和，不被传输。    
UDP 也可以使用校验和机制，使用时也需要添加 12 字节的伪首部。只不过 TCP 协议中校验和机制是必须的，而 UDP 是可选项。        


#### 序列号和确认应答 ACK 机制        

TCP 报文段的首部由一个序列号字段，指的是该报文段第一个字节的序号（一个字节一个序号）。同时报文首部也包含着该报文长度，于是接收端接收到 TCP 报文后会返回给一个确认应答 ACK 信号告知期望接收到的下一个序列号。需要注意的，并不是每发送一个报文接收端都会返回一个 ACK 信号，具体的在 滑动窗口一节进一步解释。         

#### 重传机制       

TCP 报文传输过程中有可能发生报文丢失问题，应用故障，设备过载，服务宕机等等因素都有可能导致报文丢失。重传机制用来应对报文丢失问题。常见的重传机制包括超时重传和快速重传。         

**超时重传：**      

超时重传就是 TCP 发送方在发送报文的时候设定一个定时器，如果在规定时间没没有收到接收方发来的 ACK 确认报文（包括报文段丢失和 ACK 相应丢失两种情况），发送方就会重传这个已发送的报文段。超时重传的等待时间用 RTO (Retransmission TImeOut) 表示。理想的 RTO 应该是略大于报文段往返时间 RTT（Round-Trip TIme） ，太大了，则网络空闲时间增大，降低网络传输效率；太小了将产生不必要的重传导致网络符合增大。受网络环境影响， RTT 的大小也是动态变化的。三次握手建立连接时得到一个 RTT 初始值，而后随着每次发送报文和接收到 ACK 报文的时间差会动态的更新 RTT  ，RTO 随之更新始终保持略大于 RTT。      
如果超时重传也失败了，TCP 协议的策略是将重传的时间间隔加倍，也就是说每一次超时重传失败，都会将下一次重传的超时时间间隔设置为先前值的两倍。这又带来了一个新的问题：超时重传周期可能会比较长。

快速重传机制可以解决超时重传时间间隔加倍带来的重传周期变长的问题。      

**快速重传：**       

快速重传机制不以时间为驱动，而以数据驱动重传。具体的，每当接收方收到比期望序列号大的报文段时，就想发送方发送一个 **冗余ACK** ，指明期望接收到的下一个报文。但是由于窗口的存在，接收方不需要丢弃已接收到的报文。当发送方