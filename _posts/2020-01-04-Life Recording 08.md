---
layout:     post
title:      Life Recording -- 08 
subtitle:   自建 v2ray 服务器     
date:       2022-03-03
author:     OUC_LiuX
header-img: img/wallpic02.jpg
catalog: true
tags:
    - Work Space     
    - proxy 
---

相比于按月按流量购买 v2ray 节点，自建 v2ray 服务器相对更省钱流量更多，最低可到2.5刀每月500G流量，而同样 2.5 刀，购买节点最多也只有20G流量。相应的，缺点是过程有点复杂，且不太稳定。         

## 1， 购买 VPS 服务器         
我购买的是 [vultr](https://my.vultr.com/) 提供的新泽西州服务器，价格便宜，而且支持阿里支付。       
1. 由于网站是预付费模式，就是你账户里要先有钱，然后从里面扣。于是首先要充值，充值入口在 Billing 界面，单次最低十美元，选择最便宜服务器可以用四个月。       
2. 服务器选择上，性能不做要求，网络稳定即可。于是类型选择 Cloud Computer。      
   <div align=center><img src="https://raw.githubusercontent.com/OUCliuxiang/OUCliuxiang.github.io/master/img/life/proxy01.png"></div>      
   
3. Location 选择基本决定了网速和稳定性，但是差别似乎不明显。看自己喜好或者有时间多试一试也可。我选择新泽西州，由于该地区提供唯一的 3.5 美刀每月的ipv4服务器。      
4. Server Image 方面，选择 Debian10 或 Ubuntu2004。CentOS 应该也可以，没有做尝试。        
5. Server Size 方面，看个人需求即可，最低流量 500G，应该满足绝大多数人的需求了。且，自建 v2ray 如果有大量数据进出，比如一天几十G这样，很容易被 GFW ban 掉，所以最便宜的 500G 就够了。    
6. Additional Features 方面，不用管。        
7. 右下角 Deploy Now 部署就可以了。需要注意的是，尽管网站说的是每个月多少钱，但实际计费是按小时来的，如果中间你不想用了，想停掉，扣费就到你停掉那一刻为止。     

## 2， 域名解析到购买服务器                  
将一个域名解析到 vps 服务器，实现基本的伪装。具体原理未知，猜测是一个没有绑定任何域名（网站）的域外ip存在大量莫名其妙的流量进出，就会被 GFW 判定为梯子，就会被 ban 掉。        
我有自己的域名，于是通过 “A解析（IPV4解析）” 解析一个子域名到购买的 VPS 服务器 ip 即可，TTL=86400=1天即可，太短容易不稳定 。实测不影响主域名正常使用。       
如果没有自己的域名可以到 freenom 申请一个免费的域名，解析到服务器。如果使用 freenom 提供的域名，由于 freenom 的 dns 解析对国内可能会比较不友好，你可以修改域名默认的 dns 解析服务，把 dns解析服务修改为国内的 dns 服务，比如 CloudXNS 或者 DNSPod 。       

## 3. 部署一键执行脚本
```bash         
wget -N --no-check-certificate "https://raw.githubusercontent.com/mack-a/v2ray-agent/master/install.sh"        
chmod 700 install.sh        
./install.sh           
```      

脚本执行结果如下：         
```
==============================================================
作者：mack-a
当前版本：v2.5.12
Github：https://github.com/mack-a/v2ray-agent
描述：八合一共存脚本
==============================================================
1.安装
2.任意组合安装
-------------------------工具管理-----------------------------
3.账号管理
4.更换伪装站
5.更新证书
6.更换CDN节点
7.IPv6分流
8.WARP分流
9.流媒体工具
10.添加新端口
-------------------------版本管理-----------------------------
11.core管理
12.更新脚本
13.安装BBR、DD脚本
-------------------------脚本管理-----------------------------
14.查看日志
15.卸载脚本
==============================================================
请选择:
```

安装即可，顺序是：      
安装 -> 选择核心2 v2ray-core -> 一路自动 --> 输入要配置的域名：刚刚解析到该服务器的域名 --> 一路自动默认配置 --> DNS 智能解析 【否】 --> 自定义 UUID 【否】 --> 一路默认。     
安装成功，结束。         

### 再次调出脚本
脚本执行完毕之后就消失了，要再次调出该脚本界面，需要执行 `vasma` 命令。         

### 管理账户和订阅          
该脚本中日常会用到的最多的内容是 “账号管理”，账号管理中可以添加和删除账户，并查看订阅。此处建议每台设备开设一个账户，测试结果是每台设备一个单独的订阅会比较稳定，不容易断。     

## 修改时区          
一般国外的VPS的镜像都是默认的国外时区，使用起来不是很方便。可以把它修改成北京时间，就会方便很多。 修改中国时区代码如下：
```bash
\cp -f /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
```

## 部署 VPS 加速脚本        

```bash
wget -N --no-check-certificate "https://github.000060000.xyz/tcp.sh" 
chmod +x tcp.sh 
./tcp.sh
```
脚本运行如下：        
```bash        
 TCP加速 一键安装管理脚本 [v1.3.2.104] from blog.ylx.me 母鸡慎用
 0. 升级脚本
 9. 切换到不卸载内核版本        10. 切换到一键DD系统脚本
 1. 安装 BBR原版内核
 2. 安装 BBRplus版内核          5. 安装 BBRplus新版内核
 3. 安装 Lotserver(锐速)内核    6. 安装 xanmod版内核
 11. 使用BBR+FQ加速             12. 使用BBR+FQ_PIE加速 
 13. 使用BBR+CAKE加速
 14. 使用BBR2+FQ加速            15. 使用BBR2+FQ_PIE加速 
 16. 使用BBR2+CAKE加速
 17. 开启ECN                    18. 关闭ECN
 19. 使用BBRplus+FQ版加速 
 20. 使用Lotserver(锐速)加速 
 21. 系统配置优化               22. 应用johnrosen1的优化方案
 23. 禁用IPv6                   24. 开启IPv6  
 25. 卸载全部加速               99. 退出脚本 
————————————————————————————————————————————————————————————————
 系统信息: Ubuntu 20.04.4 LTS KVM x86_64 5.16.11 
 当前状态: 已安装 BBR 加速内核 , BBR启动成功
 当前拥塞控制算法为: bbr 当前队列算法为: fq 
 请输入数字 :
```

第一次运行，25 --> 1 --> 11 使用原版内核 BBR+FQ 加速。速度可能会慢一些，其实也慢不到哪里去，但是稳。其他的内核和加速算法很容易崩掉。         
**不要运行“系统配置优化”！！** 使用之后容易不稳定。        
**安装中提示Abort kernel removal? 选择No**



